local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local plr = Players.LocalPlayer
local char = plr.Character or plr.CharacterAdded:Wait()
local hum = char:WaitForChild("Humanoid")
local hrp = char:WaitForChild("HumanoidRootPart")

local isHiding = false
local originalCollision = {}
local function setCollision(state)
	for _, part in ipairs(char:GetDescendants()) do
		if part:IsA("BasePart") and part.CanCollide ~= state then
			if state == false then
				originalCollision[part] = part.CanCollide
			end
			part.CanCollide = state
		end
	end
end

local function setTransparency(state)
	for _, part in ipairs(char:GetDescendants()) do
		if part:IsA("BasePart") then
			part.Transparency = state and 1 or 0
		end
	end
end

local function startHiding()
	if isHiding then return end
	isHiding = true
	setCollision(false) -- 무적처럼 충돌 제거
	setTransparency(true) -- 캐릭터 숨김 (시각적 효과)
	hum:SetStateEnabled(Enum.HumanoidStateType.Dead, false) -- 사망 방지
end

local function stopHiding()
	if not isHiding then return end
	isHiding = false
	setCollision(true)
	setTransparency(false)
	hum:SetStateEnabled(Enum.HumanoidStateType.Dead, true)
end

UserInputService.InputBegan:Connect(function(input, gpe)
	if gpe then return end
	if input.KeyCode == Enum.KeyCode.E then
		startHiding()
	end
end)

UserInputService.InputEnded:Connect(function(input, gpe)
	if gpe then return end
	if input.KeyCode == Enum.KeyCode.E then
		stopHiding()
	end
end)
